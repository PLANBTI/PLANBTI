<html layout:decorate="~{adm/admLayout.html}">

<head>
    <title>배송 현황 | PLANBTI</title>
</head>

<body>

<main layout:fragment="main" class="h-full my-16 min-w-screen w-full">
    <div class="mr-12">
        <p class="text-2xl" th:if="${#lists.isEmpty(orderDetails)}">
            배송 내역이 없습니다.
        </p>
        <div class="w-full" th:if="${!#lists.isEmpty(orderDetails)}">
            <h1 class="font-black text-2xl mb-12">배송 현황</h1>
            <table class="table">
                <thead>
                <tr>
                    <th class="w-32">주문명</th>
                    <th>개별 주문 번호</th>
<<<<<<< HEAD
<<<<<<< HEAD
                    <th class="w-32">상품명</th>
                    <th class="w-96">운송장 번호</th>
                    <th></th>
=======
                    <th>상품명</th>
                    <th>운송장 번호</th>
>>>>>>> ef1c41b (feat: 관리자 교환/반품 로직 구현 완료)
=======
                    <th class="w-32">상품명</th>
                    <th class="w-96">운송장 번호</th>
                    <th></th>
>>>>>>> 57c5d31 (refactor: 로직 수정 및 html 작업)
                    <th></th>
                </tr>
                </thead>
                <tbody th:each="orderDetail : ${orderDetails}">
                <tr>
<<<<<<< HEAD
<<<<<<< HEAD
                    <td th:text="${orderDetail.getOrder().getOrderName()}"></td>
                    <td id="orderDetailId" th:text="${orderDetail.getId()}"></td>
                    <td th:text="${orderDetail.getProduct().getName()}"></td>
                    <td th:if="${(orderDetail.getStatus().getName().equals('배송 준비 중') && orderDetail.getInvoiceNumber() == null)
                        || orderDetail.getStatus().getName().equals('교환 요청') || orderDetail.getStatus().getName().equals('반품')}">
                        <form th:action="@{/adm/startDelivery/{id}(id=${orderDetail.getId()})}" method="POST" onsubmit="Validation__invoiceNumber(this); return false;">
                            <input type="text" name="invoiceNumber" placeholder="운송장 번호" class="input input-bordered w-full max-w-xs" />
                            <input type="submit" class="btn btn-success btn-sm" value="저장" />
                        </form>
                    </td>
                    <td th:if="${orderDetail.getStatus().getName().equals('배송 중') && orderDetail.getInvoiceNumber() != null}" th:text="${orderDetail.getInvoiceNumber()}"></td>
                    <td>
                        <span th:if="${orderDetail.getStatus().getName().equals('교환 요청') || orderDetail.getStatus().getName().equals('반품')}"
                              class="flex justify-end badge badge-warning badge-lg ml-12" th:text="${orderDetail.getStatus().getName()}"></span>
                        <span th:if="${!(orderDetail.getStatus().getName().equals('교환 요청') || orderDetail.getStatus().getName().equals('반품'))}"
                              class="flex justify-end badge badge-primary badge-lg ml-12" th:text="${orderDetail.getStatus().getName()}"></span>
=======
                    <td th:text="${orderDetail.getOrder().orderName}"></td>
=======
                    <td th:text="${orderDetail.getOrder().getOrderName()}"></td>
>>>>>>> 57c5d31 (refactor: 로직 수정 및 html 작업)
                    <td id="orderDetailId" th:text="${orderDetail.getId()}"></td>
                    <td th:text="${orderDetail.getProduct().getName()}"></td>
                    <td th:if="${(orderDetail.getStatus().getName().equals('배송 준비 중') && orderDetail.getInvoiceNumber() == null)
                        || orderDetail.getStatus().getName().equals('교환 요청') || orderDetail.getStatus().getName().equals('반품')}">
                        <input type="text" id="invoiceNumber" placeholder="운송장 번호" class="input input-bordered w-full max-w-xs" />
                    </td>
<<<<<<< HEAD
                    <td th:if="${orderDetail.getStatus() != 'PLACED' || (orderDetail.getStatus() == 'PLACED' && orderDetail.getInvoiceNumber() != null)}"
                        th:text="${orderDetail.getInvoiceNumber()}"></td>
                    <td th:if="${orderDetail.getStatus() == 'PLACED' && orderDetail.getInvoiceNumber() == null}">
                        <button th:href="@{/adm/startDelivery/{id}(id=${orderDetail.getId()})}" onclick="Validation__invoiceNumber(this)">저장</button></td>
                    <td th:if="${orderDetail.getStatus() != 'PLACED'}">
                        <span class="flex justify-end badge badge-success badge-lg" th:text="${orderDetail.getStatus()}"></span>
>>>>>>> ef1c41b (feat: 관리자 교환/반품 로직 구현 완료)
=======
                    <td th:if="${orderDetail.getStatus().getName().equals('배송 준비 중') && orderDetail.getInvoiceNumber() != null}" th:text="${orderDetail.getInvoiceNumber()}"></td>
                    <td th:if="${(orderDetail.getStatus().getName().equals('배송 준비 중') && orderDetail.getInvoiceNumber() == null)
                        || orderDetail.getStatus().getName().equals('교환 요청') || orderDetail.getStatus().getName().equals('반품')}">
                        <button class="btn btn-success btn-sm" onclick="Validation__invoiceNumber(this)">저장</button></td>
                    <td>
                        <span th:if="${orderDetail.getStatus().getName().equals('교환 요청') || orderDetail.getStatus().getName().equals('반품')}"
                              class="flex justify-end badge badge-warning badge-lg" th:text="${orderDetail.getStatus().getName()}"></span>
                        <span th:if="${!(orderDetail.getStatus().getName().equals('교환 요청') || orderDetail.getStatus().getName().equals('반품'))}"
                              class="flex justify-end badge badge-primary badge-lg" th:text="${orderDetail.getStatus().getName()}"></span>
>>>>>>> 57c5d31 (refactor: 로직 수정 및 html 작업)
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

<<<<<<< HEAD
    <script>
        function Validation__invoiceNumber(form) {

            if (form.invoiceNumber.value.trim().length < 10) {
                toastWarning("운송장 번호를 입력해주세요.");
                form.invoiceNumber.focus();
                return;
            }

            form.submit();
        }
    </script>


=======
    <script th:inline="javascript">
        function Validation__invoiceNumber(button) {
            const invoiceNumber = document.getElementById("invoiceNumber").value;
            const orderDetailId = parseInt(document.getElementById("orderDetailId").textContent);

            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/adm/startDelivery/' + orderDetailId;

            const invoiceNumberField = document.createElement('input');
            invoiceNumberField.type = 'hidden';
            invoiceNumberField.name = 'invoiceNumber';
            invoiceNumberField.value = invoiceNumber;
            form.appendChild(invoiceNumberField);

            document.body.appendChild(form);
            form.submit();
        }
    </script>

>>>>>>> ef1c41b (feat: 관리자 교환/반품 로직 구현 완료)
</main>

</body>

</html>